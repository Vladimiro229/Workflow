<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Workflow ‚Äî Hesh-like</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --line:#e5e7ef;
      --line2:#eef1f7;

      --blue:#3b82f6;
      --green:#22c55e;
      --orange:#f59e0b;
      --red:#ef4444;
      --gray:#94a3b8;

      --radius:16px;
      --shadow: 0 10px 30px rgba(15,23,42,.08);
      --shadow2: 0 6px 18px rgba(15,23,42,.06);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px 16px 70px;
    }

    /* ===== Top Search ===== */
    .top{
      position: sticky;
      top:0;
      z-index:10;
      background: linear-gradient(to bottom, rgba(246,247,251,.98), rgba(246,247,251,.92));
      backdrop-filter: blur(10px);
      padding: 10px 0 14px;
      margin-bottom: 10px;
    }

    .searchRow{
      display:flex;
      gap: 12px;
      align-items:center;
    }

    .search{
      flex:1;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 12px 14px;
      border: 1px solid var(--line);
      background: #fff;
      border-radius: 999px;
      box-shadow: var(--shadow2);
    }
    .search .icon{ color: var(--muted); }
    .search input{
      width:100%;
      border:0;
      outline:0;
      font-size: 15px;
      font-weight: 650;
      color: var(--text);
      background: transparent;
    }
    .search input::placeholder{ color:#94a3b8; font-weight:600; }

    .btn{
      border: 1px solid transparent;
      background: var(--blue);
      color:#fff;
      padding: 12px 16px;
      border-radius: 999px;
      cursor:pointer;
      font-weight: 800;
      letter-spacing:.2px;
      box-shadow: var(--shadow2);
    }
    .btn:hover{ filter: brightness(.98); }
    .btnGhost{
      background:#fff;
      border:1px solid var(--line);
      color: var(--text);
    }
    .btnGhost:hover{ background:#fbfcff; }

    /* ===== Cards ===== */
    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .orderHeader{
      padding: 16px 16px 14px;
      margin-top: 10px;
    }

    .orderTopLine{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .orderId{
      font-size: 20px;
      font-weight: 900;
      letter-spacing:.2px;
    }

    .meta{
      display:flex;
      flex-wrap:wrap;
      gap: 10px 16px;
      margin-top: 8px;
      color: var(--muted);
      font-size: 13px;
      font-weight: 650;
    }
    .meta b{ color: var(--text); font-weight: 850; }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background:#fff;
      font-weight: 850;
      font-size: 12px;
      color: var(--text);
      white-space:nowrap;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;
      background: var(--gray);
      box-shadow: 0 0 0 5px rgba(148,163,184,.16);
    }
    .pill.ok{ border-color: rgba(34,197,94,.25); color: #15803d; }
    .pill.ok .dot{ background: var(--green); box-shadow: 0 0 0 5px rgba(34,197,94,.16); }

    .progressRow{
      display:flex;
      align-items:center;
      gap: 12px;
      margin-top: 14px;
    }
    .bar{
      flex:1;
      height: 10px;
      background: #eef2ff;
      border: 1px solid var(--line2);
      border-radius: 999px;
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, #60a5fa, #3b82f6);
      transition: width .35s ease;
    }
    .pct{
      min-width: 56px;
      text-align:right;
      color: var(--muted);
      font-weight: 900;
      font-size: 12px;
    }

    .sectionHead{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 12px;
      padding: 14px 16px 0;
      margin-top: 8px;
    }
    .sectionHead h3{
      margin:0;
      font-size: 14px;
      font-weight: 950;
      letter-spacing:.4px;
    }
    .summary{
      color: var(--muted);
      font-size: 12px;
      font-weight: 850;
    }

    /* ===== Items list (Hesh-like rows) ===== */
    .items{
      padding: 12px 12px 14px;
    }

    .item{
      display:flex;
      gap: 12px;
      padding: 14px;
      border: 1px solid var(--line2);
      border-radius: 14px;
      background: #fff;
      box-shadow: 0 4px 14px rgba(15,23,42,.05);
      margin-bottom: 12px;
      cursor:pointer;
      transition: transform .08s ease, border-color .12s ease;
      align-items: stretch;
    }
    .item:hover{
      transform: translateY(-1px);
      border-color: rgba(59,130,246,.22);
    }

    .thumb{
      width: 54px;
      height: 54px;
      border-radius: 14px;
      border: 1px solid var(--line2);
      background: linear-gradient(180deg,#fbfcff,#f1f5ff);
      display:flex;
      align-items:center;
      justify-content:center;
      flex: 0 0 auto;
      overflow:hidden;
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }
    .thumb .emoji{ font-size: 22px; color:#475569; }

    .itemMain{
      flex:1;
      min-width:0;
    }

    /* --- FIXED layout: title + status aligned, chips ordered --- */
    .titleRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
    }
    .titleBlock{
      flex:1;
      min-width:0;
    }
    .itemTitle{
      margin:0;
      font-size: 15px;
      font-weight: 900;
      line-height:1.25;
    }
    .skuLine{
      margin-top: 6px;
      color: var(--muted);
      font-size: 12px;
      font-weight: 650;
    }

    .statusPill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 12px;
      border: 1px solid var(--line);
      background:#fff;
      white-space: nowrap;

      flex: 0 0 auto;        /* –∫–ª—é—á–æ–≤–µ: –Ω–µ —Å—Ç–∏—Å–∫–∞—î—Ç—å—Å—è */
      align-self: flex-start; /* –Ω–µ –∑ º—ó–∂–¥–∂–∞—î –≤–Ω–∏–∑ */
      margin-left: 10px;
    }
    .statusPill .sDot{ width:9px;height:9px;border-radius:999px;background: var(--gray); }

    .st-done{ color:#15803d; border-color: rgba(34,197,94,.25); }
    .st-done .sDot{ background: var(--green); }

    .st-progress{ color:#1d4ed8; border-color: rgba(59,130,246,.25); }
    .st-progress .sDot{ background: var(--blue); }

    .st-paused{ color:#b45309; border-color: rgba(245,158,11,.25); }
    .st-paused .sDot{ background: var(--orange); }

    .st-blocked{ color:#b91c1c; border-color: rgba(239,68,68,.25); }
    .st-blocked .sDot{ background: var(--red); }

    .st-canceled{ color:#475569; border-color: rgba(148,163,184,.35); }
    .st-canceled .sDot{ background: var(--gray); }

    .chipsRow{
      margin-top: 10px;
      display:flex;
      flex-wrap:wrap;
      gap: 8px 10px;
      align-items:center;
    }

    .chip{
      display:inline-flex;
      gap:6px;
      align-items:center;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--line2);
      background:#fff;
      font-weight: 750;
      color:#475569;
      white-space: nowrap;
      max-width: 100%;
    }
    .chip strong{
      color: var(--text);
      font-weight: 900;
    }

    .itemRight{
      width: 220px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      gap:10px;
      flex: 0 0 auto;
      padding-left: 4px;
    }

    .smallLabel{
      color: var(--muted);
      font-size: 11px;
      font-weight: 900;
      letter-spacing:.2px;
      text-transform: uppercase;
      text-align:right;
    }
    .miniBar{
      height: 8px;
      border-radius: 999px;
      background:#f1f5f9;
      border: 1px solid var(--line2);
      overflow:hidden;
    }
    .miniBar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(34,197,94,.9), rgba(34,197,94,.55));
      transition: width .35s ease;
    }
    .miniBar.blue > div{
      background: linear-gradient(90deg, rgba(59,130,246,.9), rgba(59,130,246,.55));
    }
    .miniBar.orange > div{
      background: linear-gradient(90deg, rgba(245,158,11,.95), rgba(245,158,11,.55));
    }
    .miniBar.red > div{
      background: linear-gradient(90deg, rgba(239,68,68,.9), rgba(239,68,68,.55));
    }

    @media (max-width: 860px){
      .item{ flex-direction:column; }
      .itemRight{ width:100%; }
      .smallLabel{ text-align:left; }
    }

    /* ===== Drawer (details) ===== */
    .overlay{
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,.35);
      display:none;
      justify-content:flex-end;
      z-index: 60;
    }
    .overlay.show{ display:flex; }

    .drawer{
      width: min(520px, 100%);
      height: 100%;
      background: #fff;
      border-left: 1px solid var(--line);
      box-shadow: -16px 0 50px rgba(15,23,42,.25);
      display:flex;
      flex-direction:column;
    }

    .drawerHd{
      padding: 16px 16px 12px;
      border-bottom: 1px solid var(--line2);
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:flex-start;
    }
    .drawerTitle{
      margin:0;
      font-size: 16px;
      font-weight: 950;
      line-height:1.2;
    }
    .drawerMeta{
      margin-top: 10px;
      display:flex;
      flex-wrap:wrap;
      gap: 8px 12px;
      color: var(--muted);
      font-size: 12px;
      font-weight: 650;
    }
    .drawerMeta b{ color:var(--text); font-weight: 900; }

    .close{
      width: 42px;
      height: 42px;
      border-radius: 12px;
      border: 1px solid var(--line2);
      background:#fff;
      cursor:pointer;
      font-size: 18px;
      font-weight: 900;
      color: var(--text);
    }
    .close:hover{ background:#fbfcff; }

    .drawerSub{
      padding: 12px 16px;
      border-bottom: 1px solid var(--line2);
      display:flex;
      flex-wrap:wrap;
      gap: 10px 14px;
      color: var(--muted);
      font-size: 12px;
      font-weight: 700;
    }
    .drawerSub b{ color: var(--text); font-weight: 900; }

    .legend{
      padding: 10px 16px 0;
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
    }
    .legend .pill{ padding: 7px 10px; font-size: 11px; border-color: var(--line2); }

    .tasks{
      padding: 12px 16px 20px;
      overflow:auto;
    }

    .task{
      border: 1px solid var(--line2);
      border-radius: 14px;
      padding: 12px;
      background:#fff;
      display:flex;
      justify-content:space-between;
      gap: 12px;
      align-items:flex-start;
      margin-bottom: 10px;
    }
    .taskLeft{
      display:flex;
      gap: 10px;
      min-width:0;
    }
    .tDot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      margin-top: 5px;
      background: var(--gray);
      flex: 0 0 auto;
    }
    .tName{
      margin:0;
      font-size: 13px;
      font-weight: 900;
      line-height:1.25;
      word-break: break-word;
    }
    .tNote{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 12px;
      font-weight: 550;
      line-height:1.45;
    }

    .taskRight{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap: 8px;
      flex: 0 0 auto;
    }
    .tTime{
      color: var(--muted);
      font-size: 12px;
      font-weight: 850;
      white-space:nowrap;
    }

    .empty{
      border: 1px dashed rgba(59,130,246,.35);
      border-radius: 14px;
      padding: 14px;
      color: var(--muted);
      font-weight: 750;
      background:#fff;
    }

    .errorBox{
      margin-top: 10px;
      padding: 12px 14px;
      border: 1px solid rgba(239,68,68,.25);
      background: #fff;
      border-radius: 14px;
      color:#b91c1c;
      font-weight: 750;
      display:none;
    }
    .errorBox.show{ display:block; }
    .mutedNote{
      color: var(--muted);
      font-size: 12px;
      font-weight: 650;
      margin-top: 8px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="searchRow">
        <div class="search">
          <div class="icon">üîé</div>
          <input id="q" placeholder="–ù–∞–ø—Ä.: O-AW-3918" autocomplete="off" />
        </div>
        <button class="btn" id="btnSearch">–ó–Ω–∞–π—Ç–∏</button>
        <button class="btn btnGhost" id="btnDemo">–î–µ–º–æ</button>
      </div>
      <div class="errorBox" id="err"></div>
    </div>

    <!-- Order -->
    <div class="card orderHeader" id="orderBox" style="display:none;">
      <div class="orderTopLine">
        <div>
          <div class="orderId" id="orderId">‚Äî</div>
          <div class="meta" id="orderMeta"></div>
        </div>
        <div class="pill ok" id="syncPill"><span class="dot"></span> Sync: OK</div>
      </div>

      <div class="progressRow">
        <div class="bar"><div id="orderBar"></div></div>
        <div class="pct" id="orderPct">‚Äî%</div>
      </div>

      <div class="sectionHead">
        <h3>–ü–æ–∑–∏—Ü—ñ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>
        <div class="summary" id="itemsSummary">‚Äî</div>
      </div>

      <div class="items" id="items"></div>
    </div>

    <div class="mutedNote">
      –ù–∞—Ç–∏—Å–Ω–∏ –Ω–∞ –ø–æ–∑–∏—Ü—ñ—é ‚Äî —Å–ø—Ä–∞–≤–∞ –≤—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è –¥–µ—Ç–∞–ª—å–Ω–∏–π Workflow –∑ —É—Å—ñ–º–∞ –∑–∞–¥–∞—á–∞–º–∏, —ó—Ö —Å—Ç–∞—Ç—É—Å–æ–º —ñ —á–∞—Å–æ–º –∑–º—ñ–Ω–∏.
    </div>
  </div>

  <!-- Drawer -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="drawer" role="dialog" aria-modal="true">
      <div class="drawerHd">
        <div>
          <p class="drawerTitle" id="drawerTitle">‚Äî</p>
          <div class="drawerMeta" id="drawerMeta"></div>
        </div>
        <button class="close" id="btnClose" aria-label="Close">√ó</button>
      </div>

      <div class="drawerSub" id="drawerSub"></div>

      <div class="legend">
        <span class="statusPill st-done"><span class="sDot"></span> –í–∏–∫–æ–Ω–∞–Ω–æ</span>
        <span class="statusPill st-progress"><span class="sDot"></span> –£ —Ä–æ–±–æ—Ç—ñ</span>
        <span class="statusPill st-paused"><span class="sDot"></span> –ù–∞ –ø–∞—É–∑—ñ</span>
        <span class="statusPill st-blocked"><span class="sDot"></span> –ó–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ</span>
        <span class="statusPill st-canceled"><span class="sDot"></span> –°–∫–∞—Å–æ–≤–∞–Ω–æ</span>
      </div>

      <div class="tasks" id="tasks"></div>
    </div>
  </div>

  <script>
    /*********************************************************
     * IMPORTANT (for your IT)
     * Hesh API tokens SHOULD NOT be used directly in browser.
     * Make a backend/proxy endpoint like /api/order?externalId=...
     * and return a normalized JSON in the same structure as DEMO.
     *********************************************************/

    const DEMO = {
      order: {
        external_order_id: "O-AW-3918",
        created_at: "21.02.2026",
        deadline: "13.02.2026",
        customer: "–ú–∞—Ä–∏–Ω–∞ Awarder",
        sync_status: "OK",
        progress: 79
      },
      line_items: [
        {
          id:"LI-1010-GREEN",
          title:"–ö–æ—Ä–æ–±–æ—á–∫–∞ —Ç–∞–∫—Ç–∏—á–Ω–∞ 1010 ‚Äî —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏–π –¥–∏–∑–∞–π–Ω",
          sku:"1010 –ó–µ–ª–µ–Ω–∞",
          qty:1,
          status:"Done",
          percent:100,
          current:"–í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä—É",
          next:"‚Äî",
          changed_last:"21.02.2026 22:00",
          thumb_emoji:"üì¶",
          tasks: [
            { name:"–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞–∫–µ—Ç—É", status:"Done", changed_at:"21.02.2026 10:12", note:"‚Äî" },
            { name:"–ö–æ–Ω—Ç—Ä–æ–ª—å –º–∞–∫–µ—Ç—É", status:"Done", changed_at:"21.02.2026 10:40", note:"‚Äî" },
            { name:"–î—Ä—É–∫ –Ω–∞ –ø–ª—ñ–≤—Ü—ñ", status:"Done", changed_at:"21.02.2026 11:05", note:"‚Äî" },
            { name:"–í–∏—Ä—ñ–∑–∞–Ω–Ω—è —Ü–∏—Ñ–µ—Ä–±–ª–∞—Ç–∞", status:"Done", changed_at:"21.02.2026 12:20", note:"‚Äî" },
            { name:"–ó–±—ñ—Ä–∫–∞ —Ü–∏—Ñ–µ—Ä–±–ª–∞—Ç–∞", status:"Done", changed_at:"21.02.2026 13:10", note:"‚Äî" },
            { name:"–ö–æ–Ω—Ç—Ä–æ–ª—å —è–∫–æ—Å—Ç—ñ —Ü–∏—Ñ–µ—Ä–±–ª–∞—Ç–∞", status:"Done", changed_at:"21.02.2026 13:45", note:"‚Äî" },
            { name:"–ó–±—ñ—Ä–∫–∞ –≥–æ–¥–∏–Ω–Ω–∏–∫–∞", status:"Done", changed_at:"21.02.2026 16:05", note:"‚Äî" },
            { name:"–ù–∞–Ω–µ—Å–µ–Ω–Ω—è –≥—Ä–∞–≤—ñ—é–≤–∞–Ω–Ω—è", status:"Done", changed_at:"21.02.2026 18:10", note:"‚Äî" },
            { name:"–ö–æ–Ω—Ç—Ä–æ–ª—å —è–∫–æ—Å—Ç—ñ –≥–æ–¥–∏–Ω–Ω–∏–∫–∞", status:"Done", changed_at:"21.02.2026 19:00", note:"‚Äî" },
            { name:"–í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä—É", status:"Done", changed_at:"21.02.2026 22:00", note:"‚Äî" }
          ]
        },
        {
          id:"LI-AW055",
          title:"Awarder 055 ‚Äî —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏–π –¥–∏–∑–∞–π–Ω",
          sku:"Silver-Black",
          qty:1,
          status:"InProgress",
          percent:58,
          current:"–ó–±—ñ—Ä–∫–∞ —Ü–∏—Ñ–µ—Ä–±–ª–∞—Ç–∞",
          next:"–ö–æ–Ω—Ç—Ä–æ–ª—å —è–∫–æ—Å—Ç—ñ —Ü–∏—Ñ–µ—Ä–±–ª–∞—Ç–∞",
          changed_last:"21.02.2026 14:02",
          thumb_emoji:"‚åö",
          tasks: [
            { name:"–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞–∫–µ—Ç—É", status:"Done", changed_at:"21.02.2026 09:30", note:"‚Äî" },
            { name:"–ö–æ–Ω—Ç—Ä–æ–ª—å –º–∞–∫–µ—Ç—É", status:"Done", changed_at:"21.02.2026 10:05", note:"‚Äî" },
            { name:"–î—Ä—É–∫ –Ω–∞ –ø–ª—ñ–≤—Ü—ñ", status:"Done", changed_at:"21.02.2026 10:40", note:"‚Äî" },
            { name:"–í–∏—Ä—ñ–∑–∞–Ω–Ω—è —Ü–∏—Ñ–µ—Ä–±–ª–∞—Ç–∞", status:"Done", changed_at:"21.02.2026 11:50", note:"‚Äî" },
            { name:"–ó–±—ñ—Ä–∫–∞ —Ü–∏—Ñ–µ—Ä–±–ª–∞—Ç–∞", status:"InProgress", changed_at:"21.02.2026 12:15", note:"–ê–∫—Ç–∏–≤–Ω–∞ –∑–∞–¥–∞—á–∞" },
            { name:"–ö–æ–Ω—Ç—Ä–æ–ª—å —è–∫–æ—Å—Ç—ñ —Ü–∏—Ñ–µ—Ä–±–ª–∞—Ç–∞", status:"Paused", changed_at:"21.02.2026 14:02", note:"–û—á—ñ–∫—É—î –¥–µ—Ç–∞–ª—ñ" },
            { name:"–ó–±—ñ—Ä–∫–∞ –≥–æ–¥–∏–Ω–Ω–∏–∫–∞", status:"Canceled", changed_at:"‚Äî", note:"–©–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∏" },
            { name:"–ù–∞–Ω–µ—Å–µ–Ω–Ω—è –≥—Ä–∞–≤—ñ—é–≤–∞–Ω–Ω—è", status:"Canceled", changed_at:"‚Äî", note:"‚Äî" },
            { name:"–ö–æ–Ω—Ç—Ä–æ–ª—å —è–∫–æ—Å—Ç—ñ –≥–æ–¥–∏–Ω–Ω–∏–∫–∞", status:"Canceled", changed_at:"‚Äî", note:"‚Äî" },
            { name:"–í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä—É", status:"Canceled", changed_at:"‚Äî", note:"‚Äî" }
          ]
        }
      ]
    };

    const $ = (id) => document.getElementById(id);

    function esc(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function showError(msg){
      const el = $("err");
      el.textContent = msg;
      el.classList.add("show");
    }
    function clearError(){
      const el = $("err");
      el.textContent = "";
      el.classList.remove("show");
    }

    function statusLabel(s){
      return ({
        Done:"–í–∏–∫–æ–Ω–∞–Ω–æ",
        InProgress:"–£ —Ä–æ–±–æ—Ç—ñ",
        Paused:"–ù–∞ –ø–∞—É–∑—ñ",
        Blocked:"–ó–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ",
        Canceled:"–°–∫–∞—Å–æ–≤–∞–Ω–æ"
      }[s] || "‚Äî");
    }
    function statusClass(s){
      return ({
        Done:"st-done",
        InProgress:"st-progress",
        Paused:"st-paused",
        Blocked:"st-blocked",
        Canceled:"st-canceled"
      }[s] || "st-canceled");
    }
    function statusBarClass(s){
      if(s==="Done") return "";            // green default
      if(s==="InProgress") return "blue";
      if(s==="Paused") return "orange";
      if(s==="Blocked") return "red";
      return "";
    }
    function dotClass(s){
      if(s==="Done") return "background: var(--green)";
      if(s==="InProgress") return "background: var(--blue)";
      if(s==="Paused") return "background: var(--orange)";
      if(s==="Blocked") return "background: var(--red)";
      return "background: var(--gray)";
    }
    function safeNum(n, def=0){
      const x = Number(n);
      return Number.isFinite(x) ? x : def;
    }

    // ===== This is what IT will replace (real fetch) =====
    async function fetchOrder(externalId){
      // DEMO behavior:
      const data = JSON.parse(JSON.stringify(DEMO));
      data.order.external_order_id = externalId;

      if(!externalId || externalId.length < 3) {
        throw new Error("–í–≤–µ–¥–∏ –∫–æ—Ä–µ–∫—Ç–Ω–∏–π –Ω–æ–º–µ—Ä –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.");
      }
      return data;

      // REAL (example, should be backend proxy):
      // const r = await fetch(`/api/order?externalId=${encodeURIComponent(externalId)}`);
      // if(!r.ok) throw new Error("–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∞–±–æ –ø–æ–º–∏–ª–∫–∞ API.");
      // return await r.json();
    }

    function render(data){
      $("orderBox").style.display = "block";

      $("orderId").textContent = data.order.external_order_id;

      $("orderMeta").innerHTML = `
        <span>üìÖ –°—Ç–≤–æ—Ä–µ–Ω–æ: <b>${esc(data.order.created_at)}</b></span>
        <span>‚è≥ –î–µ–¥–ª–∞–π–Ω: <b>${esc(data.order.deadline)}</b></span>
        <span>üë§ –ö–ª—ñ—î–Ω—Ç: <b>${esc(data.order.customer)}</b></span>
      `;

      const syncOk = String(data.order.sync_status || "OK").toUpperCase() === "OK";
      $("syncPill").className = "pill " + (syncOk ? "ok" : "");
      $("syncPill").innerHTML = `<span class="dot"></span> Sync: ${esc(data.order.sync_status || "‚Äî")}`;

      const op = safeNum(data.order.progress, 0);
      $("orderBar").style.width = `${op}%`;
      $("orderPct").textContent = `${op}%`;

      const items = data.line_items || [];
      const total = items.length;
      const inWork = items.filter(x=>x.status==="InProgress").length;
      const risks = items.filter(x=>x.status==="Blocked").length;
      $("itemsSummary").textContent = `–ö-—Å—Ç—å –ø–æ–∑–∏—Ü—ñ–π: ${total} ¬∑ –£ —Ä–æ–±–æ—Ç—ñ: ${inWork} ¬∑ –†–∏–∑–∏–∫–∏: ${risks}`;

      const root = $("items");
      root.innerHTML = "";

      if(!total){
        root.innerHTML = `<div class="empty">–ù–µ–º–∞—î –ø–æ–∑–∏—Ü—ñ–π —É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—ñ</div>`;
        return;
      }

      items.forEach(li=>{
        const stCls = statusClass(li.status);
        const pct = safeNum(li.percent, 0);
        const barCls = statusBarClass(li.status);
        const changed = li.changed_last || "‚Äî";

        const el = document.createElement("div");
        el.className = "item";
        el.innerHTML = `
          <div class="thumb">
            ${li.thumb_url ? `<img src="${esc(li.thumb_url)}" alt="">` : `<div class="emoji">${esc(li.thumb_emoji || "üì¶")}</div>`}
          </div>

          <div class="itemMain">
            <div class="titleRow">
              <div class="titleBlock">
                <p class="itemTitle">${esc(li.title)}</p>
                <div class="skuLine">SKU: <b>${esc(li.sku)}</b></div>
              </div>

              <span class="statusPill ${stCls}">
                <span class="sDot"></span> ${esc(statusLabel(li.status))}
              </span>
            </div>

            <div class="chipsRow">
              <span class="chip">–ö-—Å—Ç—å: <strong>${safeNum(li.qty, 0)}</strong></span>
              <span class="chip">Current: <strong>${esc(li.current || "‚Äî")}</strong></span>
              <span class="chip">Next: <strong>${esc(li.next || "‚Äî")}</strong></span>
              <span class="chip">–ß–∞—Å –∑–º—ñ–Ω–∏: <strong>${esc(changed)}</strong></span>
            </div>
          </div>

          <div class="itemRight">
            <div class="smallLabel">–ü—Ä–æ–≥—Ä–µ—Å</div>
            <div class="miniBar ${barCls}">
              <div style="width:${pct}%"></div>
            </div>
            <div class="smallLabel">${pct}%</div>
          </div>
        `;

        el.addEventListener("click", ()=> openDetails(li));
        root.appendChild(el);
      });
    }

    function openDetails(li){
      $("overlay").classList.add("show");
      $("overlay").setAttribute("aria-hidden","false");

      $("drawerTitle").textContent = li.title;

      const stCls = statusClass(li.status);

      $("drawerMeta").innerHTML = `
        <span>ID: <b>${esc(li.id)}</b></span>
        <span>SKU: <b>${esc(li.sku)}</b></span>
        <span>–ö-—Å—Ç—å: <b>${safeNum(li.qty,0)}</b></span>
        <span>–û—Å—Ç–∞–Ω–Ω—è –∑–º—ñ–Ω–∞: <b>${esc(li.changed_last || "‚Äî")}</b></span>
        <span class="statusPill ${stCls}" style="padding:7px 10px; font-size:11px;">
          <span class="sDot"></span> ${esc(statusLabel(li.status))}
        </span>
      `;

      $("drawerSub").innerHTML = `
        <span>Current: <b>${esc(li.current || "‚Äî")}</b></span>
        <span>Next: <b>${esc(li.next || "‚Äî")}</b></span>
        <span>–ü—Ä–æ–≥—Ä–µ—Å: <b>${safeNum(li.percent,0)}%</b></span>
      `;

      const tasksRoot = $("tasks");
      tasksRoot.innerHTML = "";

      const tasks = li.tasks || [];
      if(!tasks.length){
        tasksRoot.innerHTML = `<div class="empty">–ù–µ–º–∞—î –∑–∞–¥–∞—á –ø–æ —Ü—ñ–π –ø–æ–∑–∏—Ü—ñ—ó</div>`;
        return;
      }

      tasks.forEach(t=>{
        const tCls = statusClass(t.status);
        const dotStyle = dotClass(t.status);

        const row = document.createElement("div");
        row.className = "task";
        row.innerHTML = `
          <div class="taskLeft">
            <div class="tDot" style="${dotStyle}"></div>
            <div style="min-width:0">
              <p class="tName">${esc(t.name)}</p>
              <p class="tNote">${esc(t.note || "‚Äî")}</p>
            </div>
          </div>
          <div class="taskRight">
            <span class="statusPill ${tCls}" style="padding:7px 10px; font-size:11px;">
              <span class="sDot"></span> ${esc(statusLabel(t.status))}
            </span>
            <span class="tTime">${esc(t.changed_at || "‚Äî")}</span>
          </div>
        `;
        tasksRoot.appendChild(row);
      });
    }

    function closeDetails(){
      $("overlay").classList.remove("show");
      $("overlay").setAttribute("aria-hidden","true");
    }

    async function onSearch(){
      clearError();
      const externalId = $("q").value.trim();
      if(!externalId){
        showError("–í–≤–µ–¥–∏ –Ω–æ–º–µ—Ä –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (external_order_id), –Ω–∞–ø—Ä. O-AW-3918");
        return;
      }

      try{
        const data = await fetchOrder(externalId);
        render(data);
      }catch(e){
        console.error(e);
        showError(e?.message || "–ü–æ–º–∏–ª–∫–∞. –ü–µ—Ä–µ–≤—ñ—Ä –Ω–æ–º–µ—Ä –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∞–±–æ API.");
        $("orderBox").style.display = "none";
      }
    }

    // Events
    $("btnSearch").addEventListener("click", onSearch);
    $("btnDemo").addEventListener("click", ()=>{
      $("q").value = DEMO.order.external_order_id;
      render(DEMO);
      clearError();
    });
    $("q").addEventListener("keydown",(e)=>{ if(e.key==="Enter") onSearch(); });
    $("btnClose").addEventListener("click", closeDetails);
    $("overlay").addEventListener("click",(e)=>{ if(e.target === $("overlay")) closeDetails(); });
    window.addEventListener("keydown",(e)=>{ if(e.key==="Escape") closeDetails(); });

    // Init with demo so page never "white screens"
    render(DEMO);
  </script>
</body>
</html>
